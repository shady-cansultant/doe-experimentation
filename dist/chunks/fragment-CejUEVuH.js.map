{"version":3,"file":"fragment-CejUEVuH.js","sources":["../../src/blocks/fragment/fragment.js"],"sourcesContent":["/*\n * Fragment Block\n * Include content on a page as a fragment.\n * https://www.aem.live/developer/block-collection/fragment\n */\n\nimport {\n  decorateMain,\n} from '../../scripts/scripts.js';\n\nimport {\n  loadSections,\n} from '../../scripts/aem.js';\n\n/**\n * Loads a fragment.\n * @param {string} path The path to the fragment\n * @returns {HTMLElement} The root element of the fragment\n */\nexport async function loadFragment(path) {\n  if (path && path.startsWith('/')) {\n    // eslint-disable-next-line no-param-reassign\n    path = path.replace(/(\\.plain)?\\.html/, '');\n    const resp = await fetch(`${path}.plain.html`);\n    if (resp.ok) {\n      const main = document.createElement('main');\n      main.innerHTML = await resp.text();\n\n      // reset base path for media to fragment base\n      const resetAttributeBase = (tag, attr) => {\n        main.querySelectorAll(`${tag}[${attr}^=\"./media_\"]`).forEach((elem) => {\n          elem[attr] = new URL(elem.getAttribute(attr), new URL(path, window.location)).href;\n        });\n      };\n      resetAttributeBase('img', 'src');\n      resetAttributeBase('source', 'srcset');\n\n      decorateMain(main);\n      await loadSections(main);\n      return main;\n    }\n  }\n  return null;\n}\n\nexport default async function decorate(block) {\n  const link = block.querySelector('a');\n  const path = link ? link.getAttribute('href') : block.textContent.trim();\n  const fragment = await loadFragment(path);\n  if (fragment) {\n    const fragmentSection = fragment.querySelector(':scope .section');\n    if (fragmentSection) {\n      block.classList.add(...fragmentSection.classList);\n      block.classList.remove('section');\n      block.replaceChildren(...fragmentSection.childNodes);\n    }\n  }\n}\n"],"names":["loadFragment","path","resp","main","resetAttributeBase","tag","attr","elem","decorateMain","loadSections","decorate","block","link","fragment","fragmentSection"],"mappings":"iDAmBO,eAAeA,EAAaC,EAAM,CACvC,GAAIA,GAAQA,EAAK,WAAW,GAAG,EAAG,CAEhCA,EAAOA,EAAK,QAAQ,mBAAoB,EAAE,EAC1C,MAAMC,EAAO,MAAM,MAAM,GAAGD,CAAI,aAAa,EAC7C,GAAIC,EAAK,GAAI,CACX,MAAMC,EAAO,SAAS,cAAc,MAAM,EAC1CA,EAAK,UAAY,MAAMD,EAAK,KAAM,EAGlC,MAAME,EAAqB,CAACC,EAAKC,IAAS,CACxCH,EAAK,iBAAiB,GAAGE,CAAG,IAAIC,CAAI,eAAe,EAAE,QAASC,GAAS,CACrEA,EAAKD,CAAI,EAAI,IAAI,IAAIC,EAAK,aAAaD,CAAI,EAAG,IAAI,IAAIL,EAAM,OAAO,QAAQ,CAAC,EAAE,IACxF,CAAS,CACF,EACD,OAAAG,EAAmB,MAAO,KAAK,EAC/BA,EAAmB,SAAU,QAAQ,EAErCI,EAAaL,CAAI,EACjB,MAAMM,EAAaN,CAAI,EAChBA,CACb,CACA,CACE,OAAO,IACT,CAEe,eAAeO,EAASC,EAAO,CAC5C,MAAMC,EAAOD,EAAM,cAAc,GAAG,EAC9BV,EAAOW,EAAOA,EAAK,aAAa,MAAM,EAAID,EAAM,YAAY,KAAM,EAClEE,EAAW,MAAMb,EAAaC,CAAI,EACxC,GAAIY,EAAU,CACZ,MAAMC,EAAkBD,EAAS,cAAc,iBAAiB,EAC5DC,IACFH,EAAM,UAAU,IAAI,GAAGG,EAAgB,SAAS,EAChDH,EAAM,UAAU,OAAO,SAAS,EAChCA,EAAM,gBAAgB,GAAGG,EAAgB,UAAU,EAEzD,CACA"}