{"version":3,"file":"sidekick-BVxUvja5.js","sources":["../../src/scripts/sidekick.js"],"sourcesContent":["async function getContentSourceUrl(owner, repo, ref) {\n  const res = await fetch(`https://admin.hlx.page/sidekick/${owner}/${repo}/${ref}/env.json`);\n  if (!res || !res.ok) {\n    return null;\n  }\n  const env = await res.json();\n  return env?.contentSourceUrl;\n}\nasync function openWithUniversalEditor(event) {\n  const { owner, repo, ref } = event.detail.data.config;\n  const contentSourceUrl = await getContentSourceUrl(owner, repo, ref);\n  if (!contentSourceUrl) {\n    // eslint-disable-next-line no-console\n    console.error('Content source URL not found');\n    return;\n  }\n  const { pathname } = window.location;\n  const editorUrl = `${contentSourceUrl}${pathname}?cmd=open`;\n  // open the editor in a new tab\n  window.open(editorUrl, '_blank');\n}\n\nasync function getElement(sk, selector) {\n  let elt = sk.shadowRoot.querySelector(selector);\n  return new Promise((resolve) => {\n    const check = () => {\n      elt = sk.shadowRoot.querySelector(selector);\n      if (elt) {\n        resolve(elt);\n      } else {\n        setTimeout(check, 100);\n      }\n    };\n    check();\n  });\n}\n\nfunction shouldHidePlugin(plugin) {\n  const [pluginCls] = plugin.classList;\n  return ['edit', 'reload', 'publish', 'delete', 'unpublish'].indexOf(pluginCls) !== -1;\n}\n\nasync function customizeButtons(sk) {\n  const container = await getElement(sk, '.plugin-container');\n  container.style.visibility = 'hidden';\n\n  // hide the default buttons once\n  container.querySelectorAll('.plugin').forEach((plugin) => {\n    if (shouldHidePlugin(plugin)) {\n      plugin.style.display = 'none';\n    }\n  });\n  // listen for new buttons and hide them\n  new MutationObserver((mutations) => {\n    mutations.forEach((mutation) => mutation.addedNodes.forEach((node) => {\n      if (shouldHidePlugin(node)) {\n        node.style.display = 'none';\n      }\n    }));\n  }).observe(container, { childList: true });\n\n  container.style.visibility = 'visible';\n\n  // initialize the custom edit button\n  sk.addEventListener('custom:aemedit', openWithUniversalEditor);\n}\n\n// eslint-disable-next-line import/prefer-default-export\nexport async function initSidekick() {\n  let sk = document.querySelector('helix-sidekick');\n  if (sk) {\n    // sidekick already loaded\n    await customizeButtons(sk);\n  } else {\n    // wait for sidekick to be loaded\n    document.addEventListener('sidekick-ready', async () => {\n      sk = document.querySelector('helix-sidekick');\n      await customizeButtons(sk);\n    }, { once: true });\n  }\n}\n"],"names":["getContentSourceUrl","owner","repo","ref","res","env","openWithUniversalEditor","event","contentSourceUrl","pathname","editorUrl","getElement","sk","selector","elt","resolve","check","shouldHidePlugin","plugin","pluginCls","customizeButtons","container","mutations","mutation","node","initSidekick"],"mappings":"AAAA,eAAeA,EAAoBC,EAAOC,EAAMC,EAAK,CACnD,MAAMC,EAAM,MAAM,MAAM,mCAAmCH,CAAK,IAAIC,CAAI,IAAIC,CAAG,WAAW,EAC1F,GAAI,CAACC,GAAO,CAACA,EAAI,GACf,OAAO,KAET,MAAMC,EAAM,MAAMD,EAAI,KAAM,EAC5B,OAAOC,GAAA,YAAAA,EAAK,gBACd,CACA,eAAeC,EAAwBC,EAAO,CAC5C,KAAM,CAAE,MAAAN,EAAO,KAAAC,EAAM,IAAAC,CAAK,EAAGI,EAAM,OAAO,KAAK,OACzCC,EAAmB,MAAMR,EAAoBC,EAAOC,EAAMC,CAAG,EACnE,GAAI,CAACK,EAAkB,CAErB,QAAQ,MAAM,8BAA8B,EAC5C,MACJ,CACE,KAAM,CAAE,SAAAC,GAAa,OAAO,SACtBC,EAAY,GAAGF,CAAgB,GAAGC,CAAQ,YAEhD,OAAO,KAAKC,EAAW,QAAQ,CACjC,CAEA,eAAeC,EAAWC,EAAIC,EAAU,CACtC,IAAIC,EAAMF,EAAG,WAAW,cAAcC,CAAQ,EAC9C,OAAO,IAAI,QAASE,GAAY,CAC9B,MAAMC,EAAQ,IAAM,CAClBF,EAAMF,EAAG,WAAW,cAAcC,CAAQ,EACtCC,EACFC,EAAQD,CAAG,EAEX,WAAWE,EAAO,GAAG,CAExB,EACDA,EAAO,CACX,CAAG,CACH,CAEA,SAASC,EAAiBC,EAAQ,CAChC,KAAM,CAACC,CAAS,EAAID,EAAO,UAC3B,MAAO,CAAC,OAAQ,SAAU,UAAW,SAAU,WAAW,EAAE,QAAQC,CAAS,IAAM,EACrF,CAEA,eAAeC,EAAiBR,EAAI,CAClC,MAAMS,EAAY,MAAMV,EAAWC,EAAI,mBAAmB,EAC1DS,EAAU,MAAM,WAAa,SAG7BA,EAAU,iBAAiB,SAAS,EAAE,QAASH,GAAW,CACpDD,EAAiBC,CAAM,IACzBA,EAAO,MAAM,QAAU,OAE7B,CAAG,EAED,IAAI,iBAAkBI,GAAc,CAClCA,EAAU,QAASC,GAAaA,EAAS,WAAW,QAASC,GAAS,CAChEP,EAAiBO,CAAI,IACvBA,EAAK,MAAM,QAAU,OAE7B,CAAK,CAAC,CACH,CAAA,EAAE,QAAQH,EAAW,CAAE,UAAW,EAAI,CAAE,EAEzCA,EAAU,MAAM,WAAa,UAG7BT,EAAG,iBAAiB,iBAAkBN,CAAuB,CAC/D,CAGO,eAAemB,GAAe,CACnC,IAAIb,EAAK,SAAS,cAAc,gBAAgB,EAC5CA,EAEF,MAAMQ,EAAiBR,CAAE,EAGzB,SAAS,iBAAiB,iBAAkB,SAAY,CACtDA,EAAK,SAAS,cAAc,gBAAgB,EAC5C,MAAMQ,EAAiBR,CAAE,CAC/B,EAAO,CAAE,KAAM,GAAM,CAErB"}